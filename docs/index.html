<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Small Business - Fast Robot  Yiqi Sun</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body>
        <!-- Responsive navbar-->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container px-5">
                <a class="navbar-brand" href="#!">Start Bootstrap</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <li class="nav-item"><a class="nav-link active" aria-current="page" href="#!">Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="#!">About</a></li>
                        <li class="nav-item"><a class="nav-link" href="#!">Contact</a></li>
                        <li class="nav-item"><a class="nav-link" href="#!">Services</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Page Content-->
        <div class="container px-4 px-lg-5">
            <!-- Heading Row-->
            <div class="row gx-4 gx-lg-5 align-items-center my-5">
                <div class="col-lg-7"><img class="img-fluid rounded mb-4 mb-lg-0" src="https://dummyimage.com/900x400/dee2e6/6c757d.jpg" alt="..." /></div>
                <div class="col-lg-5">
                    <h1 class="font-weight-light">Fast Robot Lab Page</h1>
                    <p>This is a template for Fast robot</p>
                    <a class="btn btn-primary" href="#!">Call to Action!</a>
                </div>
            </div>
            <!-- Call to Action-->
            <div class="card text-white bg-secondary my-5 py-4 text-center">
                <div class="card-body"><p class="text-white m-0">This call to action card is a great place to showcase some important information or display a clever tagline!</p></div>
            </div>






            
            <!-- Content Row-->
            <div class="row gx-4 gx-lg-5">
                <div class="col-md-4 mb-5">
                    <div class="card h-100">
                        <div class="card-body">
                            <h2 class="card-title">Lab One</h2>
                            <p class="card-text">Lab 1: The Artemis board and Bluetooth. <br> In the first experiment, I set up a basic environment for subsequent experiments and used examples to test the environment. In addition, I also used BLE to establish Bluetooth communication between the Artemis board and the computer, and wrote multiple examples to test the transmission and reception of data in different ways.</p>
                        </div>
                        <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#labOneModal">
        More Info
    </button>
                    </div>
                <div class="modal fade" id="labOneModal" tabindex="-1" aria-labelledby="labOneModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="labOneModalLabel">Lab One Information</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
<div class="modal-body" style="overflow-y: auto; max-height: 80vh;">


                    <h2>Setting Up Computer for Python Development with the Artemis Board</h2>
    <ol>
        <li><strong>Ensure Python 3.9+ and pip 21.0+</strong> are installed. Check versions with <code>python3 --version</code> and <code>pip --version</code>.</li>
        <li><strong>Install Python and pip</strong> using my system's package manager for Linux/FreeBSD users.</li>
        <li><strong>Create a virtual environment</strong> named "FastRobots_ble" in my project directory using <code>python3 -m venv FastRobots_ble</code>.</li>
        <li><strong>Activate the virtual environment</strong> with <code>.\FastRobots_ble\Scripts\activate</code> (Windows) or its Linux/macOS equivalent.</li>
        <li><strong>Install necessary Python packages</strong> (<code>numpy</code>, <code>pyyaml</code>, <code>colorama</code>, <code>nest_asyncio</code>, <code>bleak</code>, <code>jupyterlab</code>) using pip within the virtual environment.</li>
        <li><strong>Set up the Lab 2 codebase</strong> by downloading, unzipping, and ensuring the <code>ble_python</code> directory is in my project directory.</li>
        <li><strong>Start the Jupyter server</strong> with <code>jupyter lab</code> to work on Python code in Jupyter notebooks.</li>
    </ol>
    <p>This streamlined process prepares my computer for developing Bluetooth communication projects with the Artemis board using Python.</p>
                <h2>Prelab 1 Blink test</h2>
            <p> In the first lab I ran the blink example and got the following results</p>
                <video src="images/lab1/blink.mp4" controls width="300"> </video>
                <h2 class="card-title"> Prelab 2 Serial test</h2>
                    <p>The prelab 2 is to run an Artemis example sketch that operates serial communication between the board and PC.</p>
<p>The MCU contains two UART peripherals to perform serial communication. In this sketch, the baud rate is set to be 115200. Upon running the program, the MCU counts from 0 to 9 then enters a loop where it listens and echoes messages received. The result is shown as follows.</p>
                <img src="images/lab1/serial.png" controls width="750"  >
                    <h2>Prelab 3 Analog read test</h2>
            <p> The prelab 3 is to run another Artemis example analogRead to test the temperature sensor of the MCU.</p>
<p>Upon running the example program, the MCU continuously reads data from the temperature sensor and prints the information to the serial monitor. The result shows as the demo video.</p>
                <video src="images/lab1/analog.mp4" controls width="300" > </video>
                    <h2>Prelab 4 Microphone test</h2>
            <p> In this task, an example sketch is run to test the onboard pulse density microphone (PDM). The one with the largest magnitude among the sensed frequencies is printed to the serial monitor.</p>
<p>In the demo video below, I tried to sing. The resultant data range was 100-400, indicating higher frequencies.</p>
                <video src="images/lab1/Mic.mp4"  controls width="300"> </video>
                    <h2>Prelab Additiional for 5000-level</h2>
            <p> An extra assignment involves creating a detector for the musical note "A."</p>
                <img src="images/lab1/A.png" controls width="750" > </img>
                <video src="images/lab1/A.mp4" controls width="300" > </video>
<h2>Artemis Board Setup Summary</h2>
    <ol>
        <li><strong>Obtain Artemis MAC Address:</strong> Get the BLE MAC address from the Artemis board.</li>
        <img src="images/lab1/macaddress.png" controls width="750">
        <li><strong>Update <code>connections.yaml</code>:</strong> Replace <code>artemis_address</code> with the obtained MAC address.</li>
        <li><strong>Generate UUID:</strong> Use a Python script with <code>from uuid import uuid4; print(uuid4())</code> to generate a UUID.</li>
        <li><strong>Update Files with UUID:</strong>
            <ul>
                <li>For <code>ble_arduino.ino</code>: Replace the BLEService UUID.</li>
                <li>For <code>connections.yaml</code>: Update <code>ble_service</code> with the new UUID.</li>
            </ul>
        </li>
        <li><strong>Save Changes:</strong> Ensure all files are saved with updates.</li>
        <li><strong>Test BLE Connection:</strong> Re-test to confirm everything is set up correctly.</li>
    </ol>
    <p>Note: Adjust <code>base_ble.py</code> for platform-specific configurations if necessary.</p>
                <h2 class="card-title">Task 1: ECHO</h2>
                <p class="card-text">
Issue an ECHO command to transmit a specific string from the computer to the Artemis board. For instance, when the computer dispatches the string "1" utilizing the ECHO functionality, it should anticipate receiving a modified version of the string, such as "Robot says -> 1 :)", retrieved through a GATT characteristic read operation.</p>
                <img src="images/lab1/ECHO.png" controls width="750">
                <p class="card-text">
                    The picture below is the result returned on the Serial Monitor after Artemis accepts the ECHO command.</p>
                 <img src="images/lab1/ECHO1.png" controls width="750">
     <h2 class="card-title">Task 2： GET_TIME</h2>
                <p class="card-text">
The second task is to complete a command GET_TIME_MILLIS where the MCU sends the time in the format of "T:123456".</p>
<p class="card-text">I added GET_TIME_MILLIS to the enumeration of both PC and Artemis program. I completed the command as:</p>
                <img src="images/lab1/gettimecode.png" controls width="750">
    <p class="card-text">The result shows as:</p>
                <img src="images/lab1/gettime.png" controls width="750">

     <h2 class="card-title">Task 3： Handler</h2>
                <p class="card-text">
The second task is to complete a command GET_TIME_MILLIS where the MCU sends the time in the format of "T:123456".</p>
<p class="card-text">I added GET_TIME_MILLIS to the enumeration of both PC and Artemis program. I completed the command as:</p>
                <img src="images/lab1/handler.png" controls width="750">

    <h2 class="card-title">Task 4： Loop_send</h2>
                <p class="card-text">
The second task is to complete a command GET_TIME_MILLIS where the MCU sends the time in the format of "T:123456".</p>
<p class="card-text">I added GET_TIME_MILLIS to the enumeration of both PC and Artemis program. I completed the command as:</p>
                <img src="images/lab1/sendloopcode.png" controls width="750">
    <p class="card-text">The result shows as:</p>
                <img src="images/lab1/sendloop.png" controls width="750">

    <h2 class="card-title">Task 5： Send Time Data</h2>
                <p class="card-text">
The second task is to complete a command GET_TIME_MILLIS where the MCU sends the time in the format of "T:123456".</p>
<p class="card-text">I added GET_TIME_MILLIS to the enumeration of both PC and Artemis program. I completed the command as:</p>
                <img src="images/lab1/sendtimecode.png" controls width="750">
    <p class="card-text">The result shows as:</p>
                <img src="images/lab1/sendtime.png" controls width="750">

     <h2 class="card-title">Task 6： Send Temp Data</h2>
                <p class="card-text">
The second task is to complete a command GET_TIME_MILLIS where the MCU sends the time in the format of "T:123456".</p>
<p class="card-text">I added GET_TIME_MILLIS to the enumeration of both PC and Artemis program. I completed the command as:</p>
                <img src="images/lab1/sendtempcode.png" controls width="750">
    <p class="card-text">The result shows as:</p>
                <img src="images/lab1/sendtemp.png" controls width="750">

    <h2 class="card-title">Task 7： Limitations</h2>
                <p class="card-text">
The Artemis board is equipped with 384 kB of RAM, and assuming this entire memory capacity is available for storing sampled data, it's possible to calculate the storage capacity for 16-bit data samples. By converting the board's RAM size into bits (384 * 1000 * 8) and then dividing by 16 bits (the size of each data sample), we find that a total of 192,000 16-bit samples can be accommodated. If these samples are collected at a rate of 150 Hz, the board can record data continuously for 1280 seconds before its memory is full, as 192,000 samples divided by 150 samples per second equals 1280 seconds. Consequently, this means the board can handle 256 "5-second flows," where each flow consists of 16-bit values sampled at 150 Hz. "T:123456".</p>

     <h2 class="card-title">5000-level 1 ： Data Rate</h2>
                <p class="card-text">
In order to generate messages of various lengths, I implemented a DATARATE command that prompts the MCU to dispatch a string of a specific length as determined by the PC. For instance, when the PC executes the command ble.send_command(CMD.DATARATE, 20), the MCU responds by sending back a string composed of 20 period characters ('.'), constituting a total of 20 bytes.
</p>

                <img src="images/lab1/dataratecode.png" controls width="750">
    <p class="card-text">To track the data rate in real-time, I configured a notification handler on the PC that captures the current time recv_time each time a message is received. Following this, the PC commands the Artemis board to transmit a reply that includes an extra byte. The time of dispatch send_time is noted, and the data rate is determined by dividing the message length by the time interval (recv_time - send_time), with this process repeating for each message exchange.
</p>
                <img src="images/lab1/dataratepy.png" controls width="750">
    <p class="card-text">The plot shows as:</p>
               <img src="images/lab1/datarate.png" controls width="750">
    <p class="card-text">
The graph suggests that there is a general trend where the data rate rises with the increase in message payload size. Consequently, we can infer that larger message sizes contribute to minimizing overhead proportionally and enhance the actual data transfer rate. Conversely, transmitting data in several smaller packets incurs more overhead.</p>

     <h2 class="card-title">5000-level 2 ： Reliability</h2>
                <p class="card-text">
To tally the quantity of messages dispatched and acknowledged by each party, I executed a command on the Artemis board that persistently sends messages, each tagged with a sequential index. Concurrently, the PC maintains a count of the messages it receives through a dedicated handler:</p>

                <img src="images/lab1/reliabilitycode.png" controls width="750">
                <img src="images/lab1/reliability.png" controls width="750">
    <p class="card-text">With the MCU transmitting data incessantly, it achieves the maximal possible data rate. During the examination, the computer successfully captured every message emanating from Artemis, with no data loss occurring. From this observation, it's reasonable to deduce that the communication channel is dependable.</p>
            
</div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">close</button>
            </div>
        </div>
    </div>
</div>
                </div>






    



 <!-- Content Row-->
            <div class="row gx-4 gx-lg-5">
                <div class="col-md-4 mb-5">
                    <div class="card h-100">
                        <div class="card-body">
                            <h2 class="card-title">Lab Two</h2>
                            <p class="card-text">Lab two is about IMU model and the filters applied for the data.</p>
                        </div>
                        <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#labTwoModal">
        More Info
    </button>
                    </div>
                <div class="modal fade" id="labTwoModal" tabindex="-1" aria-labelledby="labTwoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="labTwoModalLabel">Lab Two Information</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
<div class="modal-body" style="overflow-y: auto; max-height: 80vh;">


                    
 <h2 class="card-title">Task 1: IMU Setup</h2>
                <p class="card-text">
The IMU is interfaced with the Artemis microcontroller via the Qwiic breakout board. Once the IMU example code is uploaded to the Artemis, it retrieves and prints the readings from the accelerometer, gyroscope, and magnetometer sensors.</p>
                <video src="images/lab2/IMU.mp4"  controls width="300"> </video>
    <p class="card-text">In the example code, a constant AD0_VAL is defined for .begin(WIRE_PORT, AD0_VAL);. It should be set to 1, which is the default value for the SparkFun 9DoF IMU breakout, but should be 0 if the ADR jumper is closed.</p>
                <img src="images/lab2/chuizhi.png" controls width="750">
    <p class="card-text">I added codes to blink the LED on Artemis when IMU is connected and started as a visual indication:</p>
    <img src="images/lab2/blink.png" controls width="750">\



    <h2 class="card-title">Task 2: Accelerometer</h2>
    <h2 class="card-title">(a) Pitch and Roll</h2>
                <p class="card-text">
Accelerometer readings can be turned into pitch and roll through mathematical calculations. Pitch is given by pitch_a = atan2(myICM.accX(),myICM.accZ())*180/M_PI, and roll is given by roll_a = atan2(myICM.accY(),myICM.accZ())*180/M_PI.</p>
<img src="images/lab2/pitchcode.png" controls width="750">
    <p class="card-text">
Example outputs for {-90, 0, 90} degrees pitch and roll are:</p>
                <img src="images/lab2/pitch.png" controls width="750">
  <h2 class="card-title">(b) Accuracy Discussion</h2>
    <p class="card-text">
While noise significantly impacts the precision of accelerometer readings, resulting in an error of around ±2 degrees, the accuracy remains relatively high, with readings typically centered around the true values. Consequently, I believe that a two-point calibration is unnecessary in this scenario.</p>

<h2 class="card-title">(c) Frequency Spectrum Analysis</h2>
    <p class="card-text">
FFT is used to analyze noise in accelerometer readings. I sampled roll data with a sample rate of 64 for 5 seconds and got 320 points to perform FFT. During the sampling period, I slowly turned IMU around its x-axis.</p>
     <img src="images/lab2/fftcode.png" controls width="750">
     <img src="images/lab2/fft.png" controls width="750">
    <p class="card-text">
        With the sampled data from Artemis, a python script was run to generate FFT result:</p>
    <img src="images/lab2/fftcode1.png" controls width="750">
    <img src="images/lab2/f.png" controls width="750">
  <p class="card-text">  
The frequency domain plot reveals that the primary component, representing the pertinent data, is situated in the low-frequency region near 0 Hz. Notably, there are no significant spikes evident in the frequency domain plot, likely due to the default selection of a low-pass filter for the accelerometer in the IMU chip. However, if I were to opt for another cut-off frequency to further attenuate residual noise, I would select 5 Hz. This choice would retain essential low-frequency data while effectively filtering out the majority of the noise.</p>



    <h2 class="card-title">Task 3: Gyroscope</h2>
    <h2 class="card-title">(a) Pitch, Roll, and Yaw</h2>
<p class="card-text">
    Gyroscope data are collected to calculate pitch, roll and yaw:</p>
<img src="images/lab2/gycode.png" controls width="750">
    <p class="card-text">
   Below are some example outputs at different gestures:</p>
    <img src="images/lab2/gy1.png" controls width="750">
    <img src="images/lab2/gy2.png" controls width="750">

    <h2 class="card-title">(b) Complementary Filter</h2>
    <p class="card-text">
The accelerometer, being sensitive to noise but resistant to drifting, complements the gyroscope, which produces smooth but drifting results. By combining the two sensors with a complementary filter, their respective drawbacks can be mitigated. The filter equation is represented as: theta = (theta + gyr_data * dt) * (1 - alpha) + acc_data * alpha.</p>
    <img src="images/lab2/gycode1.png" controls width="750">
    <p class="card-text">
        After several tests, I chose alpha to be 0.3 to maximize performance. Here's the video demonstrating results from accelerometer only, gyroscope only, and combined, which is close to the accurate accelerometer result but without noise:</p>
    <img src="images/lab2/gyb.png" controls width="750">


    <h2 class="card-title">Task 4: Sample Data</h2>
    <p class="card-text">
To transmit IMU data to a PC, I introduced a new command called GET_SAMPLE_IMU. This command collects IMU data into arrays, then transmits the data to the PC via Bluetooth. The data is formatted as follows: time|accx,accy,accz|gyrx,gyry,gyrz.</p>
    <img src="images/lab2/samplecode.png" controls width="750">
<p class="card-text">
    Received data are processed by a notification handler in Python and then plotted:</p>
    <img src="images/lab2/samplepy.png" controls width="750">
    <img src="images/lab2/sample.png" controls width="750">

    <p class="card-text">
Considering that an integer occupies 2 bytes and a float occupies 4 bytes, each sample will require 3 integers (6 bytes) and 6 floats (24 bytes), totaling 30 bytes. With a sampling rate of 10 samples per second, each second will generate 300 bytes of data. With 384 kB of RAM available on the Artemis, it can support approximately 1310 seconds of continuous sampling when the entire memory is allocated to the arrays.</p>


    <h2 class="card-title">Task 5: Record a Stunt</h2>
<p class="card-text">
    With the remote control, I managed to make the RC car perform stunts like flipping and spinning in place. To do a flip, the motors should first dash in one direction then motors abruptly inverse direction.</p>
<video src="images/lab2/Robot.mp4"  controls width="300"> </video>

</div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">close</button>
            </div>
        </div>
    </div>
</div>
                </div>



                
                <div class="col-md-4 mb-5">
                    <div class="card h-100">
                        <div class="card-body">
                            <h2 class="card-title">Lab Three</h2>
                            <p class="card-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Rem magni quas ex numquam, maxime minus quam molestias corporis quod, ea minima accusamus.</p>
                        </div>
                        <div class="card-footer"><a class="btn btn-primary btn-sm" href="#!">More Info</a></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Footer-->
        <footer class="py-5 bg-dark">
            <div class="container px-4 px-lg-5"><p class="m-0 text-center text-white">Copyright &copy; my Website 2023</p></div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>
